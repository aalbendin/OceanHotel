<?php

namespace HotelBundle\Repository;

use Symfony\Component\HttpFoundation\Request;

use Doctrine\ORM\EntityRepository;

use HotelBundle\Entity\Comanda;
use HotelBundle\Entity\Reserva;
/**
 * ComandaRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ComandaRepository extends \Doctrine\ORM\EntityRepository
{

	public function calcularPreu(Request $request, $comanda){
        $session = $request->getSession();
        $modalitat = 0;
        $habitacions = 0;
        $total = 0;

        $datetime1 = $comanda->getDataEntrada();
        $datetime2 = $comanda->getDataSortida();
        $interval = $datetime1->diff($datetime2);
        $interval = intval($interval->format('%d'));

        $em = $this->getEntityManager();

        if($comanda->getId() == null ){
            $reserva =$session->get('arrayReserva');
            foreach ($reserva as $value) {
                $modalitat =  $modalitat + ($value->getModalitat()->getPreu() * $value->getHabitacio()->getPlaces());
                $habitacions = $habitacions + $value->getHabitacio()->getPreu();
            }
        }else{
            $reserva =$em->getRepository('HotelBundle:Reserva')->findBy(array('comanda' => $comanda->getId()));
            foreach ($reserva as $value) {
              $modalitat =  $modalitat + ($value->getModalitat()->getPreu() * $value->getHabitacio()->getPlaces());
              $habitacions = $habitacions + $value->getHabitacio()->getPreu();
             
            }
        }  
        $modalitat = $modalitat * $interval;
        $habitacions = $habitacions *$interval;
        $total = ($modalitat+$habitacions);// * $interval;

    return array($modalitat,$habitacions,$total);  
    }

    public function calcularPreuLinea(Request $request, $comanda, $idLinea){
        $session = $request->getSession();
        $modalitat = 0;
        $habitacions = 0;
        $total = 0;

        $datetime1 = $comanda->getDataEntrada();
        $datetime2 = $comanda->getDataSortida();
        $interval = $datetime1->diff($datetime2);
        $interval = intval($interval->format('%d'));

        $em = $this->getEntityManager();

        $reserva =$em->getRepository('HotelBundle:Reserva')->findOneById($idLinea);
        $modalitat =  $reserva->getModalitat()->getPreu() * $reserva->getHabitacio()->getPlaces();
        $habitacions = $reserva->getHabitacio()->getPreu();
             
         
        $modalitat = $modalitat * $interval;
        $habitacions = $habitacions * $interval;
        $total = ($modalitat+$habitacions);

    return $total;  
    }
	

}
